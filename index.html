<!DOCTYPE html>
<meta charset="utf-8">
<style>

rect {
  stroke: #fff;
}

</style>
<body>
    <div id="tree"></div>
    <div id="tree2"></div>
<script src="//d3js.org/d3.v4.min.js"></script>

<script>

var width = 960,
    height = 500;

var x = d3.scaleLinear()
    .range([0, width]);

var y = d3.scaleLinear()
    .range([0, height]);

var color = d3.scaleOrdinal(d3.schemeCategory20c);

var partition = d3.partition()
    .size([width, height])
    .padding(0)
    .round(true);

var svg = d3.select("#tree").append("svg")
    .attr("width", width)
    .attr("height", height);

var rect = svg.selectAll("rect");

d3.json("./sample.json", function(error, root) {
  if (error) throw error;

  root = d3.hierarchy(d3.entries(root)[0], function(d) {
      return d3.entries(d.value)
    })
    .sum(function(d) { return d.value })
    .sort(function(a, b) { return b.value - a.value; });

  partition(root);

  rect = rect
      .data(root.descendants())
    .enter().append("rect")
      .attr("x", function(d) { return d.x0; })
      .attr("y", function(d) { return d.y0; })
      .attr("width", function(d) { return d.x1 - d.x0; })
      .attr("height", function(d) { return d.y1 - d.y0; })
      .attr("fill", function(d) { return color((d.children ? d : d.parent).data.key); })
      .on("click", clicked);
});

function clicked(d) {
  x.domain([d.x0, d.x1]);
  y.domain([d.y0, height]).range([d.depth ? 20 : 0, height]);

  rect.transition()
      .duration(750)
      .attr("x", function(d) { return x(d.x0); })
      .attr("y", function(d) { return y(d.y0); })
      .attr("width", function(d) { return x(d.x1) - x(d.x0); })
      .attr("height", function(d) { return y(d.y1) - y(d.y0); });
}

</script> 

<!-- 

<script>
      var margin = {top: 40, right: 40, bottom: 40, left: 40},
                w = 0.5 * 900 - margin.left - margin.right,
                h = 0.5 * 900 - margin.top - margin.bottom,
                x_range = d3.scale.linear().range([0, w]),
                y_range = d3.scale.linear().range([0, h]),
                color = d3.scale.category20c();

            var vis = d3.select('#tree').append("svg:svg")
                .attr("width", w)
                .attr("height", h)
                .style("left", margin.left + "px")
                .style("top", margin.top + "px");

            var partition = d3.layout.partition()
                .children(function(d) { return isNaN(d.value) ? d3.entries(d.value) : null; })
                .value(function(d) { return d.value; });

            d3.json("./sample.json", function(json) {
                var data = partition(json);
                console.log(d3.entries(data))
                var rect = vis.selectAll("rect").data(data).enter()
                .append("svg:rect")
                .attr("x", function(d) { return x_range(d.x); })
                .attr("y", function(d) { return y_range(d.y); })
                .attr("width", function(d) { return x_range(d.dx); })
                .attr("height", function(d) { return y_range(d.dy); })
                .attr("fill", function(d) {return color(d.name);})
                .style("cursor", "pointer")
                .on("click", click);

                var fo = vis.selectAll("foreignObject").data(data).enter()
                .append("svg:foreignObject")
                .attr("x", function(d) { return x_range(d.x); })
                .attr("y", function(d) { return y_range(d.y); })
                .attr("width", function(d) { return x_range(d.dx); })
                .attr("height", function(d) { return y_range(d.dy); })
                .style("cursor", "pointer")
                .text(function(d) { return d.name })
                .on("click", click);

                function click(d) {
                    x_range.domain([d.x, d.x + d.dx]);
                    y_range.domain([d.y, 1]).range([d.y ? 20 : 0, h]);

                    rect.transition()
                        .duration(750)
                        .attr("x", function(d) { return x_range(d.x); })
                        .attr("y", function(d) { return y_range(d.y); })
                        .attr("width", function(d) { return x_range(d.x + d.dx) - x_range(d.x); })
                        .attr("height", function(d) { return y_range(d.y + d.dy) - y_range(d.y); });

                    fo.transition()
                        .duration(750)
                        .attr("x", function(d) { return x_range(d.x); })
                        .attr("y", function(d) { return y_range(d.y); })
                        .attr("width", function(d) { return x_range(d.x + d.dx) - x_range(d.x); })
                        .attr("height", function(d) { return y_range(d.y + d.dy) - y_range(d.y); });
                }
            });

</script>  -->

<!-- 
<script>
    var width = 960,
    height = 500;

var x = d3.scale.linear()
    .range([0, width]);

var y = d3.scale.linear()
    .range([0, height]);

var color = d3.scale.category20c();

var partition = d3.layout.partition()
    .children(function(d) { return isNaN(d.value) ? d3.entries(d.value) : null; })
    .value(function(d) { return d.value; });

// define the zoomListener which calls the zoom function on the "zoom" event constrained within the scaleExtents
var zoomListener = d3.behavior.zoom().scaleExtent([0.1, 3]).on("zoom", zoom);

var svg = d3.select("#tree").append("svg")
    .attr("width", width)
    .attr("height", height)
    .call(zoomListener);

var rect = svg.selectAll("rect");

d3.json("flare-2.json", function(error, root) {
  rect = rect
      .data(partition(d3.entries(root)))
    .enter().append("rect")
      .attr("x", function(d) { return x(d.x); })
      .attr("y", function(d) { return y(d.y); })
      .attr("width", function(d) { return x(d.dx); })
      .attr("height", function(d) { return y(d.dy); })
      .attr("fill", function(d) { return color((d.children ? d : d).key); })
      .on("click", clicked);
});

function clicked(d) {
  x.domain([d.x, d.x + d.dx]);
  y.domain([d.y, 1]).range([d.y ? 20 : 0, height]);
  console.log(d.y);

  rect.transition()
      .duration(750)
      .attr("x", function(d) { return x(d.x); })
      .attr("y", function(d) { return y(d.y); })
      .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
      .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); });
}

function zoom() {
    d3.selectAll("rect").attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    }

d3.select("#reset")
    .on("click",resetZoom);

function resetZoom() {
    x.domain([0,1]);
    y.domain([0,1]);
    zoomListener.scale(1);
    zoomListener.translate([0, 0]);
    d3.selectAll("rect")
        .transition().duration(750)
        .attr("x", function(d) { return x(d.x); })
        .attr("y", function(d) { return y(d.y); })
        .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
        .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); })
        .attr('transform', 'translate(' + zoomListener.translate() + ') scale(' + zoomListener.scale() + ')');
    
    
};
</script> -->
